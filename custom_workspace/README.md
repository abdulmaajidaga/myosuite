# Custom Workspace for MyoSuite

This workspace contains custom scripts and tools for processing kinematic data (Inverse Kinematics) and training Reinforcement Learning (RL) agents within the MyoSuite environment.

## Directory Structure

```
custom_workspace/
├── alignment.json          # Configuration for coordinate alignment
├── data/                   # Input data (Kinematics, etc.)
│   └── kinematic/          # CSV files from motion capture (e.g., Stroke patients)
├── IK/                     # Inverse Kinematics Pipeline
│   ├── run.py              # MASTER SCRIPT: Main entry point for the pipeline
│   ├── run_modular.py      # Modularized version of the IK pipeline
│   ├── batch_processor.py  # Logic for batch processing multiple files
│   ├── convert_*.py        # Individual conversion scripts (CSV->TRC->MOT->Video)
│   ├── modular/            # Helper Python package for IK operations
│   └── output/             # Generated files (.trc, .mot, .mp4)
├── model/                  # Simulation models (MJCF/XML)
└── RL/                     # Reinforcement Learning experiments
    └── train_drinking_task.py  # PPO training with imitation learning
```

## Inverse Kinematics (IK) Pipeline

The IK pipeline converts raw motion capture data (CSV) into OpenSim/Mujoco compatible motion files (.mot) and renders videos.

### How to Run

The main entry point is `IK/run.py`.

```bash
cd custom_workspace/IK
python run.py
```

### Configuration (`IK/run.py`)

You can configure the pipeline by editing `IK/run.py`:

*   **`RUN_BATCH_MODE`**:
    *   `True`: Processes **all** CSV files in `data/kinematic/Stroke`.
    *   `False`: Processes a **single** file (defined by `SINGLE_INPUT_CSV`).
*   **`REF_FILE`**: `S5_12_1.csv` is often treated as a reference file and processed first in batch mode.

### Pipeline Steps

1.  **CSV to TRC** (`convert_csv2trc.py`): Converts raw marker data to TRC format.
2.  **TRC to MOT** (`convert_trc2mot.py`): Solves Inverse Kinematics to generate joint angles (.mot).
3.  **MOT to Video** (`convert_mot2video.py`): Renders the motion in the Mujoco simulation.

### Modular Pipeline

`IK/run_modular.py` is a refactored version of the pipeline that uses the `modular/` package for cleaner code organization. It performs similar steps but is structured for better maintainability.

## Reinforcement Learning (RL)

The `RL` directory contains scripts for training agents to perform tasks.

### Training (`RL/train_drinking_task.py`)

This script trains a PPO agent (using Stable Baselines 3) to perform a drinking task. It uses **Imitation Learning** by rewarding the agent for tracking a reference motion (.mot file).

**Usage:**

```bash
cd custom_workspace/RL
python train_drinking_task.py
```

*   **Input**: Requires a valid `.mot` file (generated by the IK pipeline) to use as a reference.
*   **Environment**: Uses `myo_sim` environments (e.g., `RelocateEnvV0`).

## Alignment

`alignment.json` contains manual offsets (x, y, z) and rotations (r, p, yw) used to align the motion capture data with the MyoSuite model frame.
